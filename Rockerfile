FROM resin/raspberrypi3-node:7.6-20170325

COPY package.json package.json
RUN npm install
COPY . .
RUN npm run build
EXPORT Caddyfile
EXPORT /build/ /build

FROM resin/raspberry-pi3-alpine:3.5-20170404
RUN apk add --update wget && rm -rf /var/cache/apk/*
RUN wget -qO- https://getcaddy.com | bash
IMPORT Caddyfile /home/Caddyfile
IMPORT /build/ /home/build
EXPOSE 1337
WORKDIR /home
CMD caddy -log stdout

TAG {{ .Repo }}:{{ .Version }}
